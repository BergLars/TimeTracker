<div class="layout-column">
    <md-toolbar>
        <button md-raised-button color="primary" (click)="openDialog()">NEW ENTRY</button>
        <i (click)="loadEntries()" class="material-icons">update</i>
        <span class="flex"></span>
        <span color="primary">
        <select (change)="changeRowLimits($event)">
            <option *ngFor="let limit of rowLimits" [value]="limit.value">{{limit.key}}</option>
        </select>
        </span>
    </md-toolbar>
</div>
<ngx-datatable #mydatatable class="material striped" [rows]="items" [columnMode]="'force'" [columns]="columns" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'" [selected]="selected" [selectionType]="'single'" [limit]="limit" [count]="count" [offset]="offset" (page)='onPage($event)' (select)='onSelect($event)'>
    <ngx-datatable-column name="Description">
        <ng-template ngx-datatable-cell-template let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-description'] = true" *ngIf="!editing[row.$$index + '-description']">{{ row.description }}</span>
            <input autofocus (blur)="updateValue($event, 'description', value, row)" *ngIf="editing[row.$$index + '-description']" type="text" [value]="row.description" />
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Project">
        <ng-template ngx-datatable-cell-template let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-project'] = true" *ngIf="!editing[row.$$index + '-project']">
              {{row.project.projectName}}
            </span>
            <select *ngIf="editing[row.$$index + '-project']" (change)="updateValue($event, 'project', value, row)" [value]="value">
                <option *ngFor="let project of projects" [value]="project.id">{{ project.projectName}}</option>
            </select>
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Client">
        <ng-template ngx-datatable-cell-template let-row="row">
            {{row.project.client.clientName}}
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Task">
        <ng-template ngx-datatable-cell-template let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-task'] = true" *ngIf="!editing[row.$$index + '-task']">
              {{row.task.taskDescription}}
            </span>
            <select *ngIf="editing[row.$$index + '-task']" (change)="updateValue($event, 'task', value, row)" [value]="row.task.id">
                <option *ngFor="let task of tasks" [value]="task.id">{{ task.taskDescription }}</option>
            </select>
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Date">
        <ng-template ngx-datatable-cell-template let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-date'] = true" *ngIf="!editing[row.$$index + '-date']">
                {{ row.entryDate }}</span>
            <input autofocus (blur)="updateValue($event, 'date', value, row)" *ngIf="editing[row.$$index + '-date']" type="text" [value]="value" />
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Start time">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-startTime'] = true" *ngIf="!editing[row.$$index + '-startTime']">
                {{ row.startTime }}</span>
            <input autofocus (blur)="updateValue($event, 'startTime', value, row)" *ngIf="editing[row.$$index + '-startTime']" type="time" [value]="value" />
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="End time">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
            <span title="Double click to edit" (click)="editing[row.$$index + '-endTime'] = true" *ngIf="!editing[row.$$index + '-endTime']">
                {{ row.endTime }}</span>
            <input autofocus (blur)="updateValue($event, 'endTime', value, row)" *ngIf="editing[row.$$index + '-endTime']" type="time" [value]="value" />
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Time spent">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
            <div>
                {{ row.timeSpent }}
            </div>
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Actions">
        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
            <div [hidden]="!isSelected(row)">
                <div [hidden]="editMode">
                    <!-- <span><md-icon (click)="openUpdateDialog(row)">update</md-icon></span> -->
                    <span (click)="openDeleteDialog(row)"><md-icon>delete_forever</md-icon></span>
                </div>
                <!-- <div [hidden]="!editMode">
                    <span><md-icon>check</md-icon></span>
                    <span (click)=discardChange()><md-icon>cancel</md-icon></span>
                </div> -->
            </div>
        </ng-template>
    </ngx-datatable-column>
</ngx-datatable>
